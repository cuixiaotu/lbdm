# SSH ç§é’¥é…ç½®åŠŸèƒ½è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

SSH ç§é’¥é…ç½®ç°åœ¨æ”¯æŒä¸¤ç§è¾“å…¥æ–¹å¼ï¼š
1. **æ‰‹åŠ¨å¡«å†™å†…å®¹**ï¼šç›´æ¥åœ¨æ–‡æœ¬æ¡†ä¸­ç²˜è´´ç§é’¥å†…å®¹
2. **é€‰æ‹©æ–‡ä»¶è·¯å¾„**ï¼šé€‰æ‹©ç§é’¥æ–‡ä»¶ï¼Œç³»ç»Ÿä¿å­˜æ–‡ä»¶è·¯å¾„è€Œéæ–‡ä»¶å†…å®¹

## ä½¿ç”¨æ–¹æ³•

### æ–¹å¼ä¸€ï¼šæ‰‹åŠ¨å¡«å†™ç§é’¥å†…å®¹

1. å‹¾é€‰"Use SSH key"
2. åœ¨æ–‡æœ¬æ¡†ä¸­ç›´æ¥ç²˜è´´ç§é’¥å†…å®¹
3. å†…å®¹æ ¼å¼é€šå¸¸ä¸ºï¼š
   ```
   -----BEGIN OPENSSH PRIVATE KEY-----
   b3BlbnNzaC1rZXktdjEAAAAABG5vbmUAAAAEbm9uZQAAAAAAAAABAAABl...
   -----END OPENSSH PRIVATE KEY-----
   ```

### æ–¹å¼äºŒï¼šé€‰æ‹©ç§é’¥æ–‡ä»¶

1. å‹¾é€‰"Use SSH key"
2. ç‚¹å‡»"é€‰æ‹©æ–‡ä»¶"æŒ‰é’®
3. åœ¨æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†ä¸­é€‰æ‹©ç§é’¥æ–‡ä»¶ï¼ˆå¸¸è§æ–‡ä»¶ï¼š`id_rsa`, `id_ed25519`, `*.pem`, `*.key`ï¼‰
4. ç³»ç»Ÿå°†ä¿å­˜æ–‡ä»¶è·¯å¾„ï¼Œä¾‹å¦‚ï¼š`/Users/username/.ssh/id_rsa`
5. è¿æ¥æ—¶ç³»ç»Ÿä¼šä»è¯¥è·¯å¾„è¯»å–ç§é’¥

## ç•Œé¢è¯´æ˜

### æ–‡æœ¬è¾“å…¥æ¨¡å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SSH ç§é’¥                      [é€‰æ‹©æ–‡ä»¶]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚ â”‚ -----BEGIN OPENSSH PRIVATE KEY-----        â”‚ â”‚
â”‚ â”‚ è¯·ç²˜è´´æ‚¨çš„SSHç§é’¥å†…å®¹                       â”‚ â”‚
â”‚ â”‚ -----END OPENSSH PRIVATE KEY-----          â”‚ â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚ ğŸ’¡ ç›´æ¥ç²˜è´´ç§é’¥å†…å®¹ï¼Œæˆ–ç‚¹å‡»"é€‰æ‹©æ–‡ä»¶"æŒ‡å®š       â”‚
â”‚    ç§é’¥æ–‡ä»¶è·¯å¾„                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ–‡ä»¶è·¯å¾„æ¨¡å¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SSH ç§é’¥                      [æ‰‹åŠ¨è¾“å…¥]        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ /Users/username/.ssh/id_rsa              [Ã—]   â”‚
â”‚ ğŸ’¡ å·²é€‰æ‹©æ–‡ä»¶è·¯å¾„ï¼Œç³»ç»Ÿå°†ä½¿ç”¨è¯¥è·¯å¾„çš„ç§é’¥æ–‡ä»¶   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ¨¡å¼åˆ‡æ¢

- **ä»æ–‡æœ¬è¾“å…¥åˆ‡æ¢åˆ°æ–‡ä»¶é€‰æ‹©**ï¼šç‚¹å‡»"é€‰æ‹©æ–‡ä»¶"æŒ‰é’®
- **ä»æ–‡ä»¶è·¯å¾„åˆ‡æ¢åˆ°æ–‡æœ¬è¾“å…¥**ï¼šç‚¹å‡»"æ‰‹åŠ¨è¾“å…¥"æŒ‰é’®æˆ–ç‚¹å‡»è·¯å¾„å³ä¾§çš„ Ã—

## æ•°æ®å­˜å‚¨

### é…ç½®æ•°æ®ç»“æ„

```typescript
interface SshConfig {
  server: string
  port: number
  user: string
  password: string
  useSshKey: boolean
  privateKey?: string  // å¯ä»¥æ˜¯ç§é’¥å†…å®¹æˆ–æ–‡ä»¶è·¯å¾„
}
```

### å­˜å‚¨å†…å®¹

- **æ–‡æœ¬æ¨¡å¼**ï¼š`privateKey` å­—æ®µå­˜å‚¨å®Œæ•´çš„ç§é’¥å†…å®¹
- **æ–‡ä»¶æ¨¡å¼**ï¼š`privateKey` å­—æ®µå­˜å‚¨æ–‡ä»¶è·¯å¾„ï¼ˆå¦‚ `/Users/username/.ssh/id_rsa`ï¼‰

### é…ç½®æ–‡ä»¶ç¤ºä¾‹

**æ–‡æœ¬æ¨¡å¼ï¼š**
```json
{
  "ssh": {
    "server": "192.168.1.100",
    "port": 22,
    "user": "admin",
    "useSshKey": true,
    "privateKey": "-----BEGIN OPENSSH PRIVATE KEY-----\nb3BlbnNzaC1r...\n-----END OPENSSH PRIVATE KEY-----"
  }
}
```

**æ–‡ä»¶è·¯å¾„æ¨¡å¼ï¼š**
```json
{
  "ssh": {
    "server": "192.168.1.100",
    "port": 22,
    "user": "admin",
    "useSshKey": true,
    "privateKey": "/Users/username/.ssh/id_rsa"
  }
}
```

## è¯†åˆ«æ–¹å¼

åœ¨ä½¿ç”¨é…ç½®æ—¶ï¼Œå¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è¯†åˆ«ç§é’¥ç±»å‹ï¼š

```typescript
function getPrivateKeyType(privateKey: string): 'content' | 'path' {
  // å¦‚æœåŒ…å« BEGIN å…³é”®å­—ï¼Œè¯´æ˜æ˜¯ç§é’¥å†…å®¹
  if (privateKey.includes('BEGIN')) {
    return 'content'
  }
  // å¦åˆ™æ˜¯æ–‡ä»¶è·¯å¾„
  return 'path'
}

// ä½¿ç”¨ç¤ºä¾‹
const config = await ConfigStore.load()
const keyType = getPrivateKeyType(config.ssh.privateKey)

if (keyType === 'content') {
  // ç›´æ¥ä½¿ç”¨ç§é’¥å†…å®¹
  connectSSH({ privateKey: config.ssh.privateKey })
} else {
  // ä»æ–‡ä»¶è·¯å¾„è¯»å–ç§é’¥
  const keyContent = fs.readFileSync(config.ssh.privateKey, 'utf-8')
  connectSSH({ privateKey: keyContent })
}
```

## å®‰å…¨å»ºè®®

### æ–‡æœ¬æ¨¡å¼å®‰å…¨æ€§

âš ï¸ **é£é™©ï¼š**
- ç§é’¥å†…å®¹æ˜æ–‡å­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­
- é…ç½®æ–‡ä»¶å¯èƒ½è¢«å…¶ä»–ç¨‹åºè¯»å–

âœ… **å»ºè®®ï¼š**
- ä»…åœ¨å¼€å‘ç¯å¢ƒä½¿ç”¨
- ç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨æ–‡ä»¶è·¯å¾„æ¨¡å¼
- è€ƒè™‘å¯¹é…ç½®æ–‡ä»¶åŠ å¯†

### æ–‡ä»¶è·¯å¾„æ¨¡å¼å®‰å…¨æ€§

âœ… **ä¼˜åŠ¿ï¼š**
- ç§é’¥æ–‡ä»¶ç”±æ“ä½œç³»ç»Ÿæƒé™ä¿æŠ¤
- é…ç½®æ–‡ä»¶åªå­˜å‚¨è·¯å¾„ï¼Œä¸åŒ…å«æ•æ„Ÿå†…å®¹
- æ›´ç¬¦åˆå®‰å…¨æœ€ä½³å®è·µ

âš ï¸ **æ³¨æ„ï¼š**
- ç¡®ä¿ç§é’¥æ–‡ä»¶æƒé™æ­£ç¡®ï¼ˆé€šå¸¸ä¸º 600ï¼‰
- ä¸è¦å°†ç§é’¥æ–‡ä»¶æ”¾åœ¨å…¬å…±ç›®å½•

## å¸¸è§ç§é’¥æ–‡ä»¶ä½ç½®

### macOS / Linux

```bash
~/.ssh/id_rsa          # RSA ç§é’¥
~/.ssh/id_ed25519      # Ed25519 ç§é’¥
~/.ssh/id_ecdsa        # ECDSA ç§é’¥
~/.ssh/id_dsa          # DSA ç§é’¥ï¼ˆå·²è¿‡æ—¶ï¼‰
```

### Windows

```powershell
C:\Users\YourName\.ssh\id_rsa
C:\Users\YourName\.ssh\id_ed25519
```

## æ”¯æŒçš„æ–‡ä»¶æ ¼å¼

- `.pem` - PEM æ ¼å¼ç§é’¥
- `.key` - é€šç”¨ç§é’¥æ–‡ä»¶
- `.ppk` - PuTTY ç§é’¥æ ¼å¼
- æ— æ‰©å±•å - OpenSSH ç§é’¥ï¼ˆå¦‚ `id_rsa`, `id_ed25519`ï¼‰

## æ•…éšœæ’é™¤

### é—®é¢˜ 1ï¼šé€‰æ‹©æ–‡ä»¶åæ˜¾ç¤ºçš„æ˜¯æ–‡ä»¶åè€Œä¸æ˜¯è·¯å¾„

**åŸå› **ï¼šæµè§ˆå™¨å®‰å…¨é™åˆ¶ï¼Œæ— æ³•ç›´æ¥è·å–æ–‡ä»¶çš„çœŸå®è·¯å¾„

**è§£å†³æ–¹æ¡ˆ**ï¼š
- åœ¨ Electron ç¯å¢ƒä¸­ï¼Œä½¿ç”¨ `dialog.showOpenDialog` è·å–çœŸå®è·¯å¾„
- éœ€è¦åœ¨ä¸»è¿›ç¨‹ä¸­å®ç°æ–‡ä»¶é€‰æ‹©å¯¹è¯æ¡†

### é—®é¢˜ 2ï¼šç§é’¥å†…å®¹è¿‡é•¿

**è§£å†³æ–¹æ¡ˆ**ï¼š
- ä½¿ç”¨æ–‡ä»¶è·¯å¾„æ¨¡å¼
- é…ç½®æ–‡ä»¶æ›´å°ï¼Œæ›´æ˜“äºç®¡ç†

### é—®é¢˜ 3ï¼šåˆ‡æ¢æ¨¡å¼åæ•°æ®ä¸¢å¤±

**è¯´æ˜**ï¼šè¿™æ˜¯é¢„æœŸè¡Œä¸º
- ä»æ–‡æœ¬æ¨¡å¼åˆ‡æ¢åˆ°æ–‡ä»¶æ¨¡å¼æ—¶ï¼Œä¹‹å‰è¾“å…¥çš„æ–‡æœ¬ä¼šè¢«æ¸…é™¤
- ä»æ–‡ä»¶æ¨¡å¼åˆ‡æ¢åˆ°æ–‡æœ¬æ¨¡å¼æ—¶ï¼Œä¹‹å‰é€‰æ‹©çš„è·¯å¾„ä¼šè¢«æ¸…é™¤

## åç»­ä¼˜åŒ–

### 1. ä½¿ç”¨ Electron Dialog API

åœ¨ä¸»è¿›ç¨‹ä¸­æ·»åŠ æ–‡ä»¶é€‰æ‹©åŠŸèƒ½ï¼š

```typescript
// src/main/index.ts
ipcMain.handle('dialog:openFile', async () => {
  const result = await dialog.showOpenDialog({
    properties: ['openFile'],
    filters: [
      { name: 'SSH Keys', extensions: ['pem', 'key', 'ppk'] },
      { name: 'All Files', extensions: ['*'] }
    ],
    defaultPath: path.join(os.homedir(), '.ssh')
  })

  if (!result.canceled && result.filePaths.length > 0) {
    return result.filePaths[0]
  }
  return null
})
```

åœ¨æ¸²æŸ“è¿›ç¨‹ä¸­è°ƒç”¨ï¼š

```typescript
const selectPrivateKeyFile = async () => {
  const filePath = await window.api.dialog.openFile()
  if (filePath) {
    config.value.ssh.privateKey = filePath
    privateKeyInputMode.value = 'file'
  }
}
```

### 2. ç§é’¥å†…å®¹åŠ å¯†

å¯¹äºå­˜å‚¨åœ¨é…ç½®æ–‡ä»¶ä¸­çš„ç§é’¥å†…å®¹ï¼Œå¯ä»¥ä½¿ç”¨ Electron çš„ `safeStorage`ï¼š

```typescript
import { safeStorage } from 'electron'

// åŠ å¯†ç§é’¥
const encrypted = safeStorage.encryptString(privateKey)

// è§£å¯†ç§é’¥
const decrypted = safeStorage.decryptString(encrypted)
```

### 3. æ–‡ä»¶è·¯å¾„éªŒè¯

æ·»åŠ ç§é’¥æ–‡ä»¶å­˜åœ¨æ€§å’Œæ ¼å¼éªŒè¯ï¼š

```typescript
function validatePrivateKeyFile(filePath: string): boolean {
  if (!fs.existsSync(filePath)) {
    return false
  }

  const content = fs.readFileSync(filePath, 'utf-8')
  return content.includes('BEGIN') && content.includes('PRIVATE KEY')
}
```

## ç›¸å…³æ–‡ä»¶

- **é…ç½®é¡µé¢**: [`src/renderer/src/views/Configuration.vue`](../src/renderer/src/views/Configuration.vue)
- **é…ç½®å­˜å‚¨**: [`src/renderer/src/stores/config.ts`](../src/renderer/src/stores/config.ts)
- **ä¸»è¿›ç¨‹é…ç½®ç®¡ç†**: [`src/main/config/configManager.ts`](../src/main/config/configManager.ts)

## æ›´æ–°æ—¥å¿—

### v1.1 (å½“å‰ç‰ˆæœ¬)

- âœ… æ”¯æŒæ‰‹åŠ¨å¡«å†™ç§é’¥å†…å®¹
- âœ… æ”¯æŒé€‰æ‹©ç§é’¥æ–‡ä»¶è·¯å¾„
- âœ… æ¨¡å¼åˆ‡æ¢åŠŸèƒ½
- âœ… æ–‡ä»¶è·¯å¾„åªè¯»æ˜¾ç¤º
- âœ… æ¸…é™¤æ–‡ä»¶è·¯å¾„åŠŸèƒ½
