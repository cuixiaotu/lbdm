# è´¦æˆ·ç®¡ç†åŠŸèƒ½å¼€å‘å®Œæˆæ–‡æ¡£

## âœ… å·²å®ŒæˆåŠŸèƒ½

### 1. æ•°æ®åº“æ¨¡å— (`src/main/database/`)

#### æ ¸å¿ƒæ–‡ä»¶

- **baseTable.ts** - æ•°æ®åº“è¡¨åŸºç±»ï¼Œæä¾›ç»Ÿä¸€çš„è¡¨ç®¡ç†æ¥å£
- **tables/accounts.ts** - è´¦æˆ·è¡¨å®ç°ï¼ŒåŒ…å«å®Œæ•´çš„CRUDæ“ä½œ
- **index.ts** - æ•°æ®åº“ç®¡ç†å™¨ï¼ˆå•ä¾‹æ¨¡å¼ï¼‰ï¼Œç®¡ç†æ•°æ®åº“è¿æ¥å’Œåˆå§‹åŒ–

#### è´¦æˆ·è¡¨ç»“æ„

```typescript
interface AccountRow {
  id: number // ä¸»é”®ï¼Œè‡ªå¢
  account_name: string // è´¦æˆ·åç§°ï¼ˆå¿…å¡«ï¼‰
  username: string // ç”¨æˆ·åï¼ˆå¿…å¡«ï¼‰
  password: string // å¯†ç ï¼ˆå¿…å¡«ï¼‰
  organization_id: string // ç®¡å®¶è´¦å·/ç»„ç»‡IDï¼ˆå¿…å¡«ï¼‰
  cookie: string // Cookieï¼ˆè‡ªåŠ¨è·å–ï¼‰
  remark?: string // å¤‡æ³¨ï¼ˆé€‰å¡«ï¼‰
  status: number // ç›‘æ§çŠ¶æ€ï¼š1-ç›‘æ§ä¸­ï¼Œ2-å·²æš‚åœï¼Œ3-å‡­è¯å¤±æ•ˆ
  created_at: number // åˆ›å»ºæ—¶é—´
  updated_at: number // æ›´æ–°æ—¶é—´
}
```

### 2. æ–°å¢å­—æ®µ

âœ… **è´¦æˆ·åç§°** - å¿…å¡«ï¼Œç”¨äºè¯†åˆ«è´¦æˆ·
âœ… **ç”¨æˆ·å** - å¿…å¡«ï¼Œç™»å½•å‡­è¯
âœ… **å¯†ç ** - å¿…å¡«ï¼Œç™»å½•å‡­è¯
âœ… **ç®¡å®¶è´¦å·ï¼ˆç»„ç»‡IDï¼‰** - å¿…å¡«ï¼Œä¸šåŠ¡å…³è”å­—æ®µ
âœ… **å¤‡æ³¨** - éå¿…å¡«ï¼Œæ”¯æŒç”¨æˆ·æ·»åŠ å¤‡æ³¨ä¿¡æ¯
âœ… **Cookie** - è‡ªåŠ¨è·å–ï¼Œç™»å½•æˆåŠŸåå›å¡«

### 3. IPCé€šä¿¡æ¥å£

#### æ–°å¢API

- `window.api.account.add()` - æ·»åŠ è´¦æˆ·åˆ°æ•°æ®åº“
- `window.api.account.list()` - è·å–æ‰€æœ‰è´¦æˆ·åˆ—è¡¨
- `window.api.account.delete(id)` - åˆ é™¤æŒ‡å®šè´¦æˆ·
- `window.api.account.update(account)` - æ›´æ–°è´¦æˆ·ä¿¡æ¯

#### å®ç°æ–‡ä»¶

- `src/shared/ipc/types.ts` - ç±»å‹å®šä¹‰
- `src/shared/ipc/channels.ts` - é¢‘é“å¸¸é‡
- `src/main/ipc/handlers.ts` - ä¸»è¿›ç¨‹å¤„ç†å™¨
- `src/preload/index.ts` å’Œ `index.d.ts` - æ¸²æŸ“è¿›ç¨‹APIæš´éœ²

### 4. UIç»„ä»¶æ›´æ–°

#### AccountAdd.vue

- âœ… æ·»åŠ è´¦æˆ·åç§°è¾“å…¥æ¡†ï¼ˆå¿…å¡«ï¼‰
- âœ… æ·»åŠ ç»„ç»‡IDè¾“å…¥æ¡†ï¼ˆå¿…å¡«ï¼‰
- âœ… æ·»åŠ å¤‡æ³¨æ–‡æœ¬åŸŸï¼ˆé€‰å¡«ï¼‰
- âœ… è¡¨å•éªŒè¯ï¼ˆæ‰€æœ‰å¿…å¡«é¡¹ï¼‰
- âœ… ä¿å­˜åˆ°SQLiteæ•°æ®åº“
- âœ… Cookieè‡ªåŠ¨å›å¡«å±•ç¤º

#### AccountList.vue

- âœ… ä»æ•°æ®åº“åŠ è½½è´¦æˆ·åˆ—è¡¨
- âœ… æ˜¾ç¤ºè´¦æˆ·åç§°ã€ç”¨æˆ·åã€ç»„ç»‡ID
- âœ… æ”¯æŒåˆ é™¤ã€æ›´æ–°çŠ¶æ€ç­‰æ“ä½œ
- âœ… é”™è¯¯å¤„ç†å’Œç”¨æˆ·æç¤º

### 5. ä¸»è¿›ç¨‹é›†æˆ

- âœ… åº”ç”¨å¯åŠ¨æ—¶è‡ªåŠ¨åˆå§‹åŒ–æ•°æ®åº“
- âœ… åº”ç”¨é€€å‡ºæ—¶è‡ªåŠ¨å…³é—­æ•°æ®åº“è¿æ¥
- âœ… æ•°æ®åº“æ–‡ä»¶è·¯å¾„ï¼š`~/Library/Application Support/lbdm/database.db`ï¼ˆmacOSï¼‰

## ğŸ“¦ ä¾èµ–å®‰è£…

å·²æˆåŠŸå®‰è£…å¹¶é…ç½®ï¼š

- `better-sqlite3-multiple-ciphers@12.4.1` - SQLiteæ•°æ®åº“ï¼ˆæ”¯æŒåŠ å¯†ï¼‰
- `@types/better-sqlite3@7.6.13` - TypeScriptç±»å‹å®šä¹‰
- `@electron/rebuild@4.0.1` - ElectronåŸç”Ÿæ¨¡å—é‡å»ºå·¥å…·

## ğŸ”§ ç¯å¢ƒé…ç½®

### package.json é…ç½®

```json
{
  "pnpm": {
    "onlyBuiltDependencies": ["better-sqlite3-multiple-ciphers"]
  }
}
```

### ç¼–è¯‘å‘½ä»¤

```bash
# é‡æ–°ç¼–è¯‘better-sqlite3ä»¥é€‚é…Electron
npx @electron/rebuild -m ./node_modules/.pnpm/better-sqlite3-multiple-ciphers@12.4.1/node_modules/better-sqlite3-multiple-ciphers
```

## ğŸš€ ä½¿ç”¨è¯´æ˜

### 1. æ·»åŠ è´¦æˆ·

1. ç‚¹å‡»Dashboardé¡µé¢çš„"æ·»åŠ è´¦æˆ·"æŒ‰é’®
2. å¡«å†™å¿…å¡«å­—æ®µï¼š
   - è´¦æˆ·åç§°
   - ç”¨æˆ·å
   - å¯†ç 
   - ç®¡å®¶è´¦å·ï¼ˆç»„ç»‡IDï¼‰
3. å¯é€‰å¡«å†™å¤‡æ³¨ä¿¡æ¯
4. ç‚¹å‡»"å¼€å§‹ç™»å½•"æŒ‰é’®
5. ç³»ç»Ÿè‡ªåŠ¨æ‰“å¼€ç™»å½•çª—å£å¹¶è·å–Cookie
6. Cookieå›å¡«åç‚¹å‡»"ä¿å­˜"
7. æ•°æ®è‡ªåŠ¨å­˜å…¥SQLiteæ•°æ®åº“

### 2. æŸ¥çœ‹è´¦æˆ·åˆ—è¡¨

- è¿›å…¥Dashboardé¡µé¢
- è´¦æˆ·åˆ—è¡¨è‡ªåŠ¨ä»æ•°æ®åº“åŠ è½½
- æ˜¾ç¤ºæ‰€æœ‰è´¦æˆ·çš„è¯¦ç»†ä¿¡æ¯

### 3. ç®¡ç†è´¦æˆ·

- **åˆ é™¤è´¦æˆ·**ï¼šç‚¹å‡»"åˆ é™¤"æŒ‰é’®ï¼ˆä»…é™å·²æš‚åœæˆ–å‡­è¯å¤±æ•ˆçš„è´¦æˆ·ï¼‰
- **å¼€å§‹ç›‘æ§**ï¼šç‚¹å‡»"å¼€å§‹"æŒ‰é’®ï¼ˆä»…é™å·²æš‚åœçš„è´¦æˆ·ï¼‰
- **æš‚åœç›‘æ§**ï¼šç‚¹å‡»"æš‚åœ"æŒ‰é’®ï¼ˆä»…é™ç›‘æ§ä¸­çš„è´¦æˆ·ï¼‰
- **æ›´æ–°å‡­è¯**ï¼šç‚¹å‡»"æ›´æ–°å‡­è¯"æŒ‰é’®ï¼ˆä»…é™å‡­è¯å¤±æ•ˆçš„è´¦æˆ·ï¼‰

## ğŸ“‚ æ•°æ®åº“ä½ç½®

- **macOS**: `~/Library/Application Support/lbdm/database.db`
- **Windows**: `%APPDATA%/lbdm/database.db`
- **Linux**: `~/.config/lbdm/database.db`

## âœ… è¿è¡ŒçŠ¶æ€

åº”ç”¨å·²æˆåŠŸå¯åŠ¨ï¼Œæ•°æ®åº“æ­£å¸¸å·¥ä½œï¼

æ—¥å¿—è¾“å‡ºï¼š

```
æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ: /Users/urionz/Library/Application Support/lbdm/database.db
[Main] Database initialized successfully
```

## ğŸ¯ æ ¸å¿ƒåŠŸèƒ½éªŒè¯

âœ… æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ
âœ… æ•°æ®åº“è¡¨åˆ›å»ºæˆåŠŸ
âœ… IPCé€šä¿¡æ­£å¸¸
âœ… UIç•Œé¢åŠ è½½æ­£å¸¸
âœ… è¡¨å•éªŒè¯æ­£å¸¸
âœ… æ‰€æœ‰TypeScriptç±»å‹æ£€æŸ¥é€šè¿‡
âœ… æ— ç¼–è¯‘é”™è¯¯

## ğŸ“ åç»­å¼€å‘å»ºè®®

1. å®ç°è´¦æˆ·å¯†ç åŠ å¯†å­˜å‚¨ï¼ˆå½“å‰ä¸ºæ˜æ–‡ï¼‰
2. æ·»åŠ è´¦æˆ·å¯¼å…¥/å¯¼å‡ºåŠŸèƒ½
3. å®ç°è´¦æˆ·æœç´¢å’Œç­›é€‰
4. æ·»åŠ è´¦æˆ·åˆ†ç»„ç®¡ç†
5. å®ç°Cookieè‡ªåŠ¨åˆ·æ–°æœºåˆ¶

## ğŸ”— ç›¸å…³æ–‡ä»¶æ¸…å•

### ä¸»è¿›ç¨‹

- `/src/main/database/index.ts`
- `/src/main/database/baseTable.ts`
- `/src/main/database/tables/accounts.ts`
- `/src/main/ipc/handlers.ts`
- `/src/main/index.ts`

### æ¸²æŸ“è¿›ç¨‹

- `/src/renderer/src/components/AccountAdd.vue`
- `/src/renderer/src/components/AccountList.vue`

### å…±äº«å±‚

- `/src/shared/ipc/types.ts`
- `/src/shared/ipc/channels.ts`

### Preload

- `/src/preload/index.ts`
- `/src/preload/index.d.ts`

---

**å¼€å‘å®Œæˆæ—¶é—´**: 2025-10-24
**çŠ¶æ€**: âœ… å·²å®Œæˆå¹¶æµ‹è¯•é€šè¿‡
